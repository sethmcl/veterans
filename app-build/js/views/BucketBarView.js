define(function(a){var b="BucketBarView",c=a("text!templates/BucketBarView.dust"),d=a("models/peopleSearchInput"),e=a("util/log"),f=a("util/channel");return dust.loadSource(dust.compile(c,b)),Backbone.View.extend({tagName:"div",events:{"click a":"removeBucket"},initialize:function(){_.bindAll(this,"render","unrender","onSearchReturned","onSearchBegin","onAddBucket","onRemoveBucket","removeBucket"),this.buckets={},this.context={buckets:[]},f.sub("search","add-bucket",this.onAddBucket),f.sub("search","remove-bucket",this.onRemoveBucket),f.sub("search","search-returned",this.onSearchReturned),f.sub("search","search-begin",this.onSearchBegin)},render:function(){var a=$(this.el);return dust.render(b,this.context,function(b,c){a.html(c)}),this},unrender:function(){return $(this.el).remove(),this},onSearchReturned:function(){},onSearchBegin:function(){},onAddBucket:function(a){var b=a.data.facetCode+"-"+a.data.code,c=a.data,d=JSON.stringify(c);e("adding bucket to bucket bar: "+b),c.json=d,this.buckets[b]=c,this.context.buckets=_.toArray(this.buckets),this.render()},onRemoveBucket:function(a){var b=a.data.facetCode+"-"+a.data.code;e("removing bucket from bucket bar: "+b),delete this.buckets[b],this.context.buckets=_.toArray(this.buckets),this.render()},removeBucket:function(a){var b=$(a.target),c=b.attr("data-bucket"),d;try{d=JSON.parse(c)}catch(a){e(a)}if(!d)return;f.pub("search","remove-bucket",{data:d})}})})